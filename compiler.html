<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roblox Lua Editor</title>
  <style>
    body { margin: 0; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
    #editor { flex-grow: 1; height: 90vh; border: none; }
    #toolbar { display: flex; gap: 0.5rem; padding: 0.5rem; background: #f5f5f5; flex-wrap: wrap; }
    button, select { padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
    input[type="file"] { display: none; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
</head>
<body>
  <div id="toolbar">
    <button onclick="saveToFile()">ðŸ’¾ Export JSON</button>
    <label for="fileLoader" style="padding: 0.5rem 1rem; background: #ccc; cursor: pointer;">ðŸ“‚ Import JSON</label>
    <input type="file" id="fileLoader" accept="application/json" onchange="loadFromFile(event)" />
    <select id="themeSelector" onchange="setTheme(this.value)"></select>
  </div>
  <div id="editor"></div>

  <script>
    const themes = {
      "roblox-dark": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "569CD6" },
          { token: "string", foreground: "D7BA7D" },
          { token: "identifier", foreground: "9CDCFE" },
          { token: "function", foreground: "4EC9B0" },
        ],
        colors: { "editor.background": "#1e1e2e" }
      },
      "roblox-light": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "0000ff" },
          { token: "string", foreground: "a31515" },
          { token: "function", foreground: "795e26" },
        ],
        colors: { "editor.background": "#ffffff" }
      },
      "neon-night": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "ff00ff" },
          { token: "string", foreground: "00ffcc" },
          { token: "function", foreground: "ffff00" },
        ],
        colors: { "editor.background": "#1a1a2e" }
      },
      "ocean-blue": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "5eb3ff" },
          { token: "string", foreground: "a7ffeb" },
          { token: "function", foreground: "ffd54f" },
        ],
        colors: { "editor.background": "#0d47a1" }
      },
      "sunset": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "ff7043" },
          { token: "string", foreground: "ffee58" },
          { token: "function", foreground: "4db6ac" },
        ],
        colors: { "editor.background": "#fff3e0" }
      },
      "matrix": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "00ff00" },
          { token: "string", foreground: "00ff00" },
          { token: "function", foreground: "00ff00" },
        ],
        colors: { "editor.background": "#000000" }
      },
      "lavender": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "7e57c2" },
          { token: "string", foreground: "ce93d8" },
          { token: "function", foreground: "9575cd" },
        ],
        colors: { "editor.background": "#f3e5f5" }
      },
      "forest": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "81c784" },
          { token: "string", foreground: "aed581" },
          { token: "function", foreground: "388e3c" },
        ],
        colors: { "editor.background": "#263238" }
      },
      "high-contrast": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "ffffff" },
          { token: "string", foreground: "ffff00" },
          { token: "function", foreground: "00ffff" },
        ],
        colors: { "editor.background": "#000000" }
      },
      "pastel": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "ba68c8" },
          { token: "string", foreground: "f48fb1" },
          { token: "function", foreground: "81d4fa" },
        ],
        colors: { "editor.background": "#fce4ec" }
      },
      "fire": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "ff8a65" },
          { token: "string", foreground: "ffccbc" },
          { token: "function", foreground: "ff7043" },
        ],
        colors: { "editor.background": "#3e2723" }
      },
      "cyberpunk": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "e91e63" },
          { token: "string", foreground: "00e5ff" },
          { token: "function", foreground: "ffea00" },
        ],
        colors: { "editor.background": "#212121" }
      },
      "iceberg": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "00acc1" },
          { token: "string", foreground: "4dd0e1" },
          { token: "function", foreground: "26c6da" },
        ],
        colors: { "editor.background": "#e0f7fa" }
      },
      "classic": {
        base: "vs",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "000080" },
          { token: "string", foreground: "800000" },
          { token: "function", foreground: "008000" },
        ],
        colors: { "editor.background": "#ffffff" }
      },
      "night-sky": {
        base: "vs-dark",
        inherit: true,
        rules: [
          { token: "keyword", foreground: "90caf9" },
          { token: "string", foreground: "f48fb1" },
          { token: "function", foreground: "ffcc80" },
        ],
        colors: { "editor.background": "#0d1117" }
      }
    };

    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' } });
    require(["vs/editor/editor.main"], function () {
      for (const theme in themes) {
        monaco.editor.defineTheme(theme, themes[theme]);
        const option = document.createElement("option");
        option.value = theme;
        option.textContent = theme;
        document.getElementById("themeSelector").appendChild(option);
      }

      monaco.editor.setTheme("roblox-dark");

      window.editor = monaco.editor.create(document.getElementById("editor"), {
        value: localStorage.getItem("robloxLuaCode") || "print(\"Hello, Roblox!\")",
        language: "lua",
        theme: "roblox-dark",
      });

      monaco.languages.registerCompletionItemProvider("lua", {
        provideCompletionItems: function(model, position) {
          const word = model.getWordUntilPosition(position);
          const range = {
            startLineNumber: position.lineNumber,
            endLineNumber: position.lineNumber,
            startColumn: word.startColumn,
            endColumn: word.endColumn
          };
          const suggestions = [
            { label: "print", kind: monaco.languages.CompletionItemKind.Function, insertText: "print()", insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet, range },
            { label: "wait", kind: monaco.languages.CompletionItemKind.Function, insertText: "wait()", insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet, range },
            { label: "game", kind: monaco.languages.CompletionItemKind.Keyword, insertText: "game", range },
            { label: "workspace", kind: monaco.languages.CompletionItemKind.Keyword, insertText: "workspace", range },
            { label: "script", kind: monaco.languages.CompletionItemKind.Keyword, insertText: "script", range },
            { label: "Instance.new", kind: monaco.languages.CompletionItemKind.Function, insertText: "Instance.new(\"\")", insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet, range },
          ];
          return { suggestions: suggestions };
        }
      });
    });

    function saveToFile() {
      const code = window.editor.getValue();
      const blob = new Blob([JSON.stringify({ code: code }, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "roblox_code.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function loadFromFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const content = JSON.parse(e.target.result);
          if (content.code) {
            window.editor.setValue(content.code);
          } else {
            alert("Invalid JSON: 'code' property missing.");
          }
        } catch (err) {
          alert("Failed to parse JSON file.");
        }
      };
      reader.readAsText(file);
    }

    function setTheme(themeName) {
      monaco.editor.setTheme(themeName);
    }
  </script>
</body>
</html>
